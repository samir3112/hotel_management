apiVersion: v1
kind: Pod
metadata:
  labels:
    app: kaniko-agent
    jenkins: agent  # This label allows Jenkins to match and schedule the agent pod
spec:
  serviceAccountName: jenkins
  containers:
    - name: kaniko
      image: gcr.io/kaniko-project/executor:latest
      imagePullPolicy: Always
      command:
        - /kaniko/executor
      args:
        - --dockerfile=/workspace/Dockerfile
        - --context=dir:///workspace/
        - --destination=docker.io/samir3112/hotel-management:latest
        - --insecure
        - --skip-tls-verify
      tty: true
      volumeMounts:
        - name: docker-config
          mountPath: /kaniko/.docker
  restartPolicy: Never
  volumes:
    - name: docker-config
      secret:
        secretName: regcred
